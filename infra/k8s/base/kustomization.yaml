apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Base resources (cloud-agnostic configurations)
# Overlays (hetzner/dev, hetzner/test, hetzner/prod) reference this base

# Common labels applied to all resources (enables kubectl apply --prune)
labels:
  - pairs:
      app.kubernetes.io/managed-by: kustomize

# Resource ordering (applied in this sequence):
# 1. Secrets (processed by workflow with actual values)
# 2. ConfigMaps
# 3. Services (must exist before StatefulSet for stable DNS)
# 4. StatefulSets (depends on Secrets, ConfigMaps, Services)
resources:
  # Secrets (all first)
  - secrets/postgres.secret.yaml
  - secrets/redis.secret.yaml

  # ConfigMaps (all second)
  - configmaps/postgres-init.configmap.yaml
  - configmaps/redis.configmap.yaml

  # Services (before workloads)
  - services/postgres.service.yaml
  - services/redis.service.yaml
  - services/jaeger.service.yaml

  # Workloads (statefulsets, deployments, etc.)
  ## StatefulSets (stateful apps)
  - statefulsets/postgres.statefulset.yaml
  - statefulsets/redis.statefulset.yaml
  - statefulsets/jaeger.statefulset.yaml

  ## Deployments (stateless apps)

  ## DaemonSets (node-level services like Logging, monitoring, networking on every node)

  ## Jobs (one-time tasks like database schema migration, initialize cache, initial data load, one-time data import)

  ## CronJobs (scheduled tasks like backups, cleanup, reports )
